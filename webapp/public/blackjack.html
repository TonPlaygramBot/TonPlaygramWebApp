<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no"
    />
    <title>Black Jack</title>
    <style>
      :root {
        --shadow: rgba(0, 0, 0, 0.45);
        /* Smaller default card scale so non-player seats appear smaller */
        --card-scale: 0.72;
        --avatar-scale: 1;
        --card-w: calc(clamp(44px, 9.6vw, 70px) * var(--card-scale));
        --card-h: calc(var(--card-w) * 1.45);
        --avatar-size: calc(54px * var(--avatar-scale));
        --seat-bg-color: #f5f5dc;
        --card-back-color: #233;
        --card-front-color: #fff;
        --player-frame-color: #000;
        --ui-scale: 1;
        --bottom-card-scale: 1.083;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        font-family:
          ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Helvetica,
          Arial;
        color: #fff;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
      }
      .stage {
        position: relative;
        width: 100vw;
        height: 100vh;
        display: grid;
        place-items: center;
        perspective: 1100px;
      }
      .stage::before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 2%;
        left: 1vw;
        right: 1vw;
        background: url('assets/icons/de2a24a7-922a-4400-8edc-027a1017224e.webp')
          center/cover no-repeat;
        z-index: 0;
      }
      /* Community cards slightly larger */
      .center {
        position: absolute;
        left: 50%;
        top: 44%;
        transform: translate(-50%, -50%);
        display: flex;
        gap: 10px;
        z-index: 2;
        /* Make community cards a bit larger */
        --card-scale: 1.2;
        --card-w: calc(clamp(44px, 9.6vw, 70px) * var(--card-scale));
        --card-h: calc(var(--card-w) * 1.45);
      }
      .community {
        padding: 4px;
        border: 4px solid #000;
        border-radius: 12px;
        background: var(--seat-bg-color);
        box-shadow: 4px 4px 0 #d4ccb3;
      }
      .seats {
        position: absolute;
        inset: 0;
        z-index: 2;
      }
      .seat {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        width: clamp(120px, 28vw, 200px);
        --card-scale: 0.567;
        --avatar-scale: 0.7;
        --card-w: calc(clamp(44px, 9.6vw, 70px) * var(--card-scale));
        --card-h: calc(var(--card-w) * 1.45);
      }
      .avatar {
        width: var(--avatar-size);
        height: var(--avatar-size);
        border-radius: 50%;
        display: grid;
        place-items: center;
        background: radial-gradient(
          circle at 30% 30%,
          #fff,
          #ddd 40%,
          #bbb 60%,
          #999 100%
        );
        color: #111;
        font-size: 28px;
        border-color: var(--player-frame-color, #000);
        box-shadow: 0 8px 20px var(--shadow);
        overflow: hidden;
        position: relative;
      }
      .frame-style-1 .avatar {
        border-style: solid;
        border-width: 2px;
      }
      .frame-style-2 .avatar {
        border-style: dashed;
        border-width: 2px;
      }
      .frame-style-3 .avatar {
        border-style: dotted;
        border-width: 2px;
      }
      .frame-style-4 .avatar {
        border-style: double;
        border-width: 4px;
      }
      .frame-style-5 .avatar {
        border-style: groove;
        border-width: 4px;
      }
      .frame-style-6 .avatar {
        border-style: ridge;
        border-width: 4px;
      }
      .frame-style-7 .avatar {
        border-style: inset;
        border-width: 4px;
      }
      .frame-style-8 .avatar {
        border-style: outset;
        border-width: 4px;
      }
      .frame-style-9 .avatar {
        border-style: solid;
        border-width: 2px;
        box-shadow: 0 8px 20px var(--shadow),
          0 0 0 2px var(--player-frame-color, #000);
      }
      .frame-style-10 .avatar {
        border-style: dashed;
        border-width: 2px;
        box-shadow: 0 8px 20px var(--shadow),
          0 0 0 2px var(--player-frame-color, #000);
      }
      .avatar-wrap {
        position: relative;
        width: var(--avatar-size);
        height: var(--avatar-size);
        display: grid;
        place-items: center;
      }
      .timer-ring {
        position: absolute;
        inset: -6px;
        border-radius: 50%;
        background: conic-gradient(
          #f5cc4e var(--progress, 0deg),
          transparent 0
        );
        -webkit-mask: radial-gradient(
          farthest-side,
          transparent calc(100% - 6px),
          #000 calc(100% - 6px)
        );
        mask: radial-gradient(
          farthest-side,
          transparent calc(100% - 6px),
          #000 calc(100% - 6px)
        );
        pointer-events: none;
      }
      .cards {
        display: flex;
        gap: 6px;
        flex-wrap: nowrap;
        position: relative;
      }
      .hand-total {
        position: absolute;
        top: -8px;
        right: -8px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: #ff0;
        color: #000;
        border: 2px solid #000;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 700;
        z-index: 3;
      }
      .hand-total.bust {
        background: #dc2626;
        color: #000;
      }
      .card {
        width: var(--card-w);
        height: var(--card-h);
        border-radius: 10px;
        position: relative;
        flex: 0 0 auto;
        background: var(--card-front-color);
        color: #111;
        font-weight: 900;
        letter-spacing: 0.3px;
        box-shadow:
          0 10px 25px var(--shadow),
          inset 0 0 0 2px rgba(0, 0, 0, 0.08);
        touch-action: none;
      }
      .card .corner {
        position: absolute;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .card .tl {
        left: 8px;
        top: 6px;
      }
      .card .br {
        right: 8px;
        bottom: 8px;
        transform: rotate(180deg);
      }
      .card .corner .rank {
        font-size: calc(var(--card-w) * 0.28);
        line-height: 1;
      }
      .card .corner .suit {
        font-size: calc(var(--card-w) * 0.18);
        line-height: 1;
      }
      .card .big {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        font-size: calc(var(--card-w) * 0.52);
        opacity: 0.9;
        filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.4));
      }
      .red {
        color: #d12d2d;
      }
      .joker {
        background: repeating-linear-gradient(
          45deg,
          #eee,
          #eee 6px,
          #ddd 6px,
          #ddd 12px
        );
      }
      .selected {
        outline: 3px solid #0ea5e9;
        transform: translateY(-6px);
      }
      .suggested {
        outline: 3px dashed #2563eb;
      }
      .card.back {
        background:
          url('assets/icons/file_00000000bc2862439eecffff3730bbe4.webp')
            center/90% no-repeat,
          repeating-linear-gradient(
            45deg,
            var(--card-back-color),
            var(--card-back-color) 6px,
            #122 6px,
            #122 12px
          );
        border: 2px solid rgba(255, 255, 255, 0.5);
        color: transparent;
      }
      .card.back::before {
        content: '';
        position: absolute;
        inset: 6px;
        border-radius: 8px;
        border: 2px dashed rgba(255, 255, 255, 0.35);
      }
      /* Winner highlight styles + seating layout */

      .card.winning {
        outline: 4px solid #facc15;
        background: #fef08a;
      }

      .community .card.winning {
        transform: translateY(-12px);
      }

      .seat.winner .avatar {
        box-shadow: 0 0 12px #facc15;
        border-color: #facc15;
      }

      .seat.winner .name {
        color: #facc15;
      }

      .moving-card {
        position: absolute;
        transition:
          left 0.4s ease,
          top 0.4s ease;
        z-index: 1000;
        pointer-events: none;
      }
      .stand-copy-wrapper {
        position: absolute;
        top: calc(-1 * var(--card-h) - 10px);
        left: 50%;
        transform: translateX(-50%) scale(0.5);
        display: flex;
        flex-direction: column;
        align-items: center;
        pointer-events: none;
      }
      .stand-copy-wrapper .stand-name {
        font-size: 10px;
        color: #fff;
        margin-top: 2px;
        text-shadow: 0 0 2px #000;
      }
      .stand-copy-wrapper .stand-name.small {
        font-size: 8px;
      }
      .seat-inner .cards.turn {
        box-shadow: 0 0 12px #facc15;
        border-color: #facc15;
      }

      .action-text {
        font-weight: 700;
        min-height: 1em;
      }
      .action-text.fold {
        color: #dc2626;
        text-shadow:
          -1px -1px 0 #fff,
          1px -1px 0 #fff,
          -1px 1px 0 #fff,
          1px 1px 0 #fff;
      }
      .action-text.call {
        color: #16a34a;
        text-shadow:
          -1px -1px 0 #fff,
          1px -1px 0 #fff,
          -1px 1px 0 #fff,
          1px 1px 0 #fff;
      }
      .action-text.check {
        color: #facc15;
        text-shadow:
          -1px -1px 0 #000,
          1px -1px 0 #000,
          -1px 1px 0 #000,
          1px 1px 0 #000;
      }
      .action-text.raise {
        color: #2563eb;
        text-shadow:
          -1px -1px 0 #fff,
          1px -1px 0 #fff,
          -1px 1px 0 #fff,
          1px 1px 0 #fff;
      }

      .seat.bottom {
        bottom: 0.5%;
        left: 50%;
        transform: translateX(-50%);
        --card-scale: var(--bottom-card-scale);
        --avatar-scale: 1;
        --card-w: calc(clamp(44px, 9.6vw, 70px) * var(--card-scale));
        --card-h: calc(var(--card-w) * 1.45);
      }

      .seat.top {
        top: 1%;
        left: 50%;
        transform: translateX(-50%);
      }

      .seat.left {
        left: 16%;
        top: 24%;
        transform: translate(-50%, -50%);
      }

      .seat.right {
        left: 84%;
        top: 24%;
        transform: translate(-50%, -50%);
      }

      .seat.bottom-left {
        left: 16%;
        top: 64%;
        transform: translate(-50%, -50%);
      }

      .seat.bottom-right {
        left: 84%;
        top: 64%;
        transform: translate(-50%, -50%);
      }
      .seat-inner {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        border: 4px solid #000;
        border-radius: 12px;
        padding: 4px;
        background: var(--seat-bg-color);
        box-shadow: 4px 4px 0 #d4ccb3;
      }
      .seat-inner .avatar {
        box-shadow: 0 0 0 2px #000;
      }
      .avatar.turn {
        box-shadow: 0 0 0 2px #facc15;
        border-color: #facc15;
      }
      .seat-inner .name {
        padding: 2px 6px;
        border: 2px solid #000;
        border-radius: 6px;
        font-size: 11px;
        max-width: 100%;
        white-space: nowrap;
        overflow: hidden;
        text-align: center;
        background: #fff;
        color: #000;
        font-weight: 700;
        text-shadow:
          -1px -1px 0 #fff,
          1px -1px 0 #fff,
          -1px 1px 0 #fff,
          1px 1px 0 #fff;
      }
      .seat.bottom .name {
        font-size: 12px;
      }
      .seat-inner .name.small {
        font-size: 9px;
      }
      .seat.bottom .name.small {
        font-size: 10px;
      }
      .seat-inner .cards {
        padding: 0;
        border: none;
        background: none;
      }
      .seat-inner .card {
        border: none;
      }
      .seat.bottom .cards {
        gap: 0;
      }
      .timer {
        font-weight: 800;
        background: rgba(0, 0, 0, 0.5);
        padding: 2px 6px;
        border-radius: 8px;
      }
      .seat-balance {
        font-size: 10px;
        color: #fff;
        display: flex;
        align-items: center;
        gap: 2px;
      }
      .seat.bottom .seat-balance {
        font-size: 12px;
      }
      .seat-balance img {
        width: 12px;
        height: 12px;
      }
      .controls {
        display: flex;
        gap: 8px;
        margin-top: 8px;
        align-items: flex-end;
        justify-content: center;
        z-index: 5;
      }
      .controls button {
        /* Slightly smaller but wider action buttons */
        width: calc(var(--avatar-size) * 1.2);
        height: calc(var(--avatar-size) * 0.8);
        padding: 0;
        border: 4px solid #000;
        border-radius: 12px;
        background: #2563eb;
        color: #fff;
        font-weight: 600;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      button:disabled {
        background: #d1d5db !important;
        color: #9ca3af !important;
      }
      #raise {
        background: #2563eb;
      }
      #call {
        background: #16a34a;
      }
      #fold {
        background: #dc2626;
      }
        .raise-container {
        position: absolute;
        bottom: 2%;
        left: 2%;
        z-index: 5;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-end;
        gap: 8px;
        padding: 0;
        padding-top: 4px;
        padding-right: 4px;
        border: none;
        border-radius: 0;
        background: none;
        transform: scale(var(--ui-scale));
        transform-origin: bottom left;
      }
      .slider-container {
        position: absolute;
        bottom: 4%;
        right: 1%;
        z-index: 5;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        padding: 0;
        border: none;
        border-radius: 0;
        background: none;
        transform: scale(var(--ui-scale));
        transform-origin: bottom right;
      }
      .raise-btn {
        width: var(--avatar-size);
        height: var(--avatar-size);
        padding: 0;
        border: 4px solid #000;
        border-radius: 50%;
        background: #2563eb;
        color: #fff;
        font-weight: 600;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .raise-amount {
        font-size: 10px;
        margin-top: 2px;
      }
      .chip-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 4px;
      }
      .raise-container .chip {
        position: static;
        left: auto;
        top: auto;
        cursor: pointer;
        border: 2px solid transparent;
        width: calc(var(--avatar-size) / 1.35);
        height: calc(var(--avatar-size) / 1.35);
      }
      .raise-container .chip:active {
        border-color: #0ea5e9;
      }
      .raise-info {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .undo-chip {
        width: calc(var(--avatar-size) / 1.3);
        height: calc(var(--avatar-size) / 1.3);
        border: 2px solid #000;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #facc15;
        color: #000;
        font-weight: 700;
        cursor: pointer;
      }
      .slider-wrap {
        width: calc(var(--avatar-size) * 2.5);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
      }
      .slider-wrap input[type='range'] {
        width: var(--avatar-size);
        height: calc(var(--avatar-size) * 2.5);
        writing-mode: bt-lr;
        -webkit-appearance: slider-vertical;
      }
      #allIn {
        background: #dc2626;
        padding: 2px 8px;
        border: 2px solid #000;
        border-radius: 8px;
        font-weight: 600;
        font-size: 12px;
        margin-bottom: 4px;
      }
      #status {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, 0);
        z-index: 2;
        font-weight: 900;
        letter-spacing: 0.3px;
        white-space: nowrap;
      }
      .status-default {
        color: #ff0;
        text-shadow: 0 2px 6px #000;
        -webkit-text-stroke: 1px #000;
      }
      .tpc-inline-icon {
        width: 1.8em;
        height: 1.8em;
        min-width: 0;
        min-height: 0;
        margin-left: 2px;
        transform: translateY(2px);
      }
      .top-controls {
        position: absolute;
        top: 4px;
        right: 8px;
        display: flex;
        gap: 4px;
        z-index: 10;
      }
      .top-controls button {
        width: 32px;
        height: 32px;
        padding: 0;
        border: 2px solid #000;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #2563eb;
        color: #fff;
        font-weight: 600;
        font-size: 14px;
        line-height: 1;
      }
      .top-controls button img {
        width: 16px;
        height: 16px;
      }
      #lobbyIcon {
        flex-direction: column;
        width: auto;
        height: auto;
        padding: 2px 5px;
        border-radius: 8px;
      }
      #lobbyIcon .arrow {
        font-size: 14px;
      }
      #lobbyIcon .label {
        font-size: 9px;
        line-height: 1;
        margin-top: 2px;
      }
      .seat.vacant .vacant-seat {
        width: var(--avatar-size);
        height: var(--avatar-size);
        border-radius: 50%;
        border: 4px solid #000;
        background: #facc15;
        color: #16a34a;
        font-weight: 700;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .settings-panel {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #fff;
        color: #000;
        padding: 16px;
        border: 2px solid #000;
        border-radius: 8px;
        z-index: 20;
        display: none;
        min-width: 200px;
      }
      .settings-panel.active {
        display: block;
      }
      .settings-panel label {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-top: 8px;
      }
      .settings-panel select,
      .settings-panel input[type='range'] {
        margin-left: 6px;
      }
      .settings-panel select option {
        color: #000;
        padding-left: 24px;
        background-size: 16px 100%;
        background-repeat: no-repeat;
      }
      .settings-actions {
        display: flex;
        gap: 8px;
        justify-content: flex-end;
        margin-top: 8px;
      }

      .pot-wrap {
        position: absolute;
        left: 50%;
        top: 32%;
        transform: translate(-50%, -50%);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        z-index: 3;
      }
      .pot {
        display: flex;
        gap: 4px;
      }
      .pot-total {
        font-size: 16px;
        font-weight: 700;
      }

      .chip {
        position: relative;
        width: calc(var(--avatar-size) / 1.6);
        height: calc(var(--avatar-size) / 1.6);
        border-radius: 50%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
      }
      .chip.small {
        width: calc(var(--avatar-size) / 2.2);
        height: calc(var(--avatar-size) / 2.2);
      }
      .chip.custom {
        display: flex;
        align-items: center;
        justify-content: center;
        background: #fff;
        color: #000;
        font-weight: bold;
      }
      .moving-pot .chip {
        width: calc(var(--avatar-size) / 1.7);
        height: calc(var(--avatar-size) / 1.7);
        z-index: 1100;
      }
      .chip.v1 {
        background-image: url('assets/icons/1chips.webp');
      }
      .chip.v2 {
        background-image: url('assets/icons/20250820_071739.webp');
      }
      .chip.v5 {
        background-image: url('assets/icons/5chips.webp');
      }
      .chip.v10 {
        background-image: url('assets/icons/10chips.webp');
      }
      .chip.v20 {
        background-image: url('assets/icons/20chips.webp');
      }
      .chip.v50 {
        background-image: url('assets/icons/50chips.webp');
      }
      .chip.v200 {
        background-image: url('assets/icons/200chips.webp');
      }
      .chip.v500 {
        background-image: url('assets/icons/500chips.webp');
      }
      .chip.v1000 {
        background-image: url('assets/icons/1000chips.webp');
      }
      .moving-pot {
        position: absolute;
        transition:
          left 0.5s ease,
          top 0.5s ease;
        display: flex;
        gap: 4px;
        flex-wrap: nowrap;
        z-index: 1100;
      }
      .folded-area {
        display: none;
      }
      .hit-stand {
        display: flex;
        gap: 8px;
        margin-top: 8px;
        align-items: flex-end;
        justify-content: center;
        z-index: 10;
      }
      .hit-stand button {
        width: calc(var(--avatar-size) * 1.2);
        height: calc(var(--avatar-size) * 0.8);
        padding: 0;
        border: 4px solid #000;
        border-radius: 12px;
        background: #2563eb;
        color: #fff;
        font-weight: 600;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }
      .hit-stand button:disabled {
        background: #d1d5db !important;
        color: #9ca3af !important;
      }
      #hitBtn {
        background: #16a34a;
      }
      #standBtn {
        background: #dc2626;
      }
      .folded {
        opacity: 0.5;
      }
    </style>
  </head>
  <body class="frame-style-1">
    <div class="stage">
      <div class="center community" id="community"></div>
      <div class="pot-wrap" id="potWrap">
        <div class="pot" id="pot"></div>
        <div class="pot-total" id="potTotal"></div>
      </div>
      <div class="raise-container" id="raiseContainer">
        <div class="chip-grid">
          <div class="chip v1000" data-value="1000"></div>
          <div class="chip v500" data-value="500"></div>
          <div class="chip v200" data-value="200"></div>
          <div class="chip v50" data-value="50"></div>
          <div class="chip v20" data-value="20"></div>
          <div class="chip v10" data-value="10"></div>
          <div class="chip v5" data-value="5"></div>
          <div class="chip v2" data-value="2"></div>
          <div class="chip v1" data-value="1"></div>
        </div>
        <div class="raise-amount" id="chipAmount">0</div>
      </div>
      <div class="slider-container">
        <div class="slider-wrap">
          <input
            type="range"
            id="raiseSlider"
            min="0"
            value="0"
            orient="vertical"
          />
          <div class="raise-amount" id="raiseSliderAmount">0</div>
        </div>
        <button class="raise-btn" id="raiseBtn">Raise</button>
      </div>
      <div class="folded-area" id="foldedArea">
        <div id="foldedLabel" class="folded-label" style="display: none">
          Folded
        </div>
        <div id="foldedCards" class="folded-cards"></div>
      </div>
      <div id="status"></div>
      <div class="seats" id="seats"></div>
    </div>
    <audio id="sndCallRaise" src="assets/sounds/Callraischip.mp3"></audio>
    <audio id="sndFlip" src="assets/sounds/flipcard-91468.mp3"></audio>
    <div class="top-controls">
      <button id="settingsBtn">⚙️</button>
      <button id="lobbyIcon">
        <span class="arrow">&#8592;</span
        ><span class="label">Return Lobby</span>
      </button>
    </div>
    <div id="settingsPanel" class="settings-panel">
      <label><input type="checkbox" id="muteCards" /> Mute Cards</label>
      <label
        >Card Volume<input
          type="range"
          id="cardVolume"
          min="0"
          max="1"
          step="0.1"
      /></label>
      <label><input type="checkbox" id="muteChips" /> Mute Chips</label>
      <label
        >Chip Volume<input
          type="range"
          id="chipVolume"
          min="0"
          max="1"
          step="0.1"
      /></label>
      <label><input type="checkbox" id="muteOthers" /> Mute Other Sounds</label>
      <label
        >Frame Style<select id="playerFrameStyle" class="style-select"></select
      ></label>
      <label
        >Frame Color<select id="playerColor" class="color-select"></select
      ></label>
      <label
        >Card Back<select id="cardBackColor" class="color-select"></select
      ></label>
      <div class="settings-actions">
        <button id="resetSettings">Reset</button>
        <button id="saveSettings">Save</button>
        <button id="closeSettings">Close</button>
      </div>
    </div>
    <script src="/flag-emojis.js"></script>
    <script src="/blackjack-api.js"></script>
    <script type="module" src="blackjack.js"></script>
  </body>
</html>
